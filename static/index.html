<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Transcribe UI</title>
  <style>
    #progress{width:100%;height:20px;background:#eee;margin-top:1em}
    #bar{height:100%;width:0;background:#6a5af9}
    pre{white-space:pre-wrap;background:#f7f7f7;padding:1em}
  </style>
</head>
<body>
  <h1>Загрузите аудио</h1>
  <input type="file" id="fileInput"><button id="btn">Загрузить</button>
  <div id="progress"><div id="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div></div>
  <div id="status"></div><pre id="transcript"></pre>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    const api = axios.create();
    document.getElementById("btn").onclick = async ()=>{
      const file = document.getElementById("fileInput").files[0];
      if(!file) return alert("Выберите файл");
      const fd = new FormData(); fd.append("file",file);
      document.getElementById("status").innerText="Загрузка...";
      try{
        const {data} = await api.post("/transcribe",fd,{
          onUploadProgress:e=>{
            const pct = Math.round(e.loaded/e.total*100);
            const bar = document.getElementById("bar");
            bar.style.width=`${pct}%`;
            bar.setAttribute("aria-valuenow",pct);
          }
        });
        poll(data.transcription_task_id);
      }catch(err){
        alert(err.response?.data?.detail||err);
      }
    };
    async function poll(id){
      document.getElementById("status").innerText="Ожидание...";
      while(true){
        const res=await api.get(`/result/${id}`);
        if(res.status===200){
          document.getElementById("status").innerText="Готово";
          document.getElementById("transcript").innerText=res.data.text;
          break;
        }
        document.getElementById("status").innerText=res.data.status;
        await new Promise(r=>setTimeout(r,2000));
      }
    }
  </script>
</body>
</html>